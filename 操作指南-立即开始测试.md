# ColorMagic æ•°æ®åº“ - ç«‹å³å¼€å§‹æµ‹è¯• ğŸš€

## â° å½“å‰çŠ¶æ€

- âœ… Docker Desktop æ­£åœ¨å¯åŠ¨ä¸­ï¼ˆé€šå¸¸éœ€è¦1-2åˆ†é’Ÿï¼‰
- âœ… å·²åˆ›å»ºå®Œæ•´æµ‹è¯•è„šæœ¬
- âœ… å·²å‡†å¤‡è¯¦ç»†çš„æ•°æ®åº“ç»“æ„æ–‡æ¡£
- â³ ç­‰å¾… Docker å°±ç»ªåå³å¯å¼€å§‹æµ‹è¯•

---

## ğŸ“‹ æµ‹è¯•å‰å‡†å¤‡ï¼ˆ5åˆ†é’Ÿï¼‰

### 1. ç­‰å¾… Docker Desktop å®Œå…¨å¯åŠ¨

**æ£€æŸ¥æ–¹æ³•**ï¼š
- æŸ¥çœ‹ç³»ç»Ÿæ‰˜ç›˜ï¼ŒDocker å›¾æ ‡æ˜¾ç¤ºä¸º **ç»¿è‰²** è¡¨ç¤ºå·²å°±ç»ª
- æˆ–è€…æ‰“å¼€å‘½ä»¤è¡Œï¼Œè¿è¡Œï¼š
  ```cmd
  docker ps
  ```
  å¦‚æœèƒ½çœ‹åˆ°åˆ—è¡¨ï¼ˆå³ä½¿æ˜¯ç©ºçš„ï¼‰ï¼Œè¯´æ˜ Docker å·²å°±ç»ª

### 2. å·²å‡†å¤‡çš„æ–‡ä»¶

åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œæˆ‘å·²ç»ä¸ºä½ åˆ›å»ºäº†ï¼š

| æ–‡ä»¶å | è¯´æ˜ |
|--------|------|
| `æœ¬åœ°æµ‹è¯•æŒ‡å—.bat` | ä¸€é”®è¿è¡Œå®Œæ•´æµ‹è¯•ï¼ˆæ¨èï¼‰ |
| `ColorMagicæ•°æ®åº“ç»“æ„è¯¦è§£.md` | æ•°æ®åº“è¯¦ç»†ç»“æ„æ–‡æ¡£ |
| `æ“ä½œæŒ‡å—-ç«‹å³å¼€å§‹æµ‹è¯•.md` | æœ¬æ–‡ä»¶ |

---

## ğŸš€ å¼€å§‹æµ‹è¯•ï¼ˆ3æ­¥å®Œæˆï¼‰

### æ–¹å¼1ï¼šä¸€é”®è‡ªåŠ¨æµ‹è¯•ï¼ˆæ¨èï¼‰â­

1. **ç­‰å¾… Docker å›¾æ ‡å˜ç»¿**ï¼ˆç³»ç»Ÿæ‰˜ç›˜å³ä¸‹è§’ï¼‰

2. **åŒå‡»è¿è¡Œæµ‹è¯•è„šæœ¬**
   ```
   åŒå‡» â†’ æœ¬åœ°æµ‹è¯•æŒ‡å—.bat
   ```

3. **æŸ¥çœ‹æµ‹è¯•ç»“æœ**
   - è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
     - âœ… å¯åŠ¨ PostgreSQL å®¹å™¨
     - âœ… éªŒè¯æ‰€æœ‰è¡¨å’Œç”¨æˆ·
     - âœ… æµ‹è¯•æ•°æ®æŸ¥è¯¢å’Œæ’å…¥
     - âœ… æ£€æŸ¥ç³»ç»Ÿå‡½æ•°
     - âœ… æ˜¾ç¤ºè¯¦ç»†ç»Ÿè®¡ä¿¡æ¯

4. **é¢„æœŸç»“æœ**
   ```
   ============================================
   ğŸ“Š æµ‹è¯•ç»“æœæ±‡æ€»
   ============================================
   
      æˆåŠŸ: 13/13
      å¤±è´¥: 0/13
   
   âœ…âœ…âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ - ColorMagic æ•°æ®åº“ç³»ç»Ÿæ­£å¸¸è¿è¡Œï¼
   ```

---

### æ–¹å¼2ï¼šæ‰‹åŠ¨é€æ­¥æµ‹è¯•

å¦‚æœä½ æƒ³äº†è§£æ¯ä¸€æ­¥çš„ç»†èŠ‚ï¼Œå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œï¼š

#### æ­¥éª¤1ï¼šå¯åŠ¨ PostgreSQL
```cmd
docker compose -f docker-compose.local.yml up -d
```

ç­‰å¾… 20 ç§’ï¼Œè®©æ•°æ®åº“åˆå§‹åŒ–å®Œæˆã€‚

#### æ­¥éª¤2ï¼šæŸ¥çœ‹å¯åŠ¨æ—¥å¿—
```cmd
docker logs postgres_local_test --tail 30
```

åº”è¯¥çœ‹åˆ°ï¼š
```
âœ… åˆ›å»ºç”¨æˆ·: colormagic_user
âœ… Site4 (ColorMagic) è¡¨å’Œæƒé™é…ç½®å®Œæˆ
PostgreSQLæ€»ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ
```

#### æ­¥éª¤3ï¼šæµ‹è¯•æ•°æ®åº“è¿æ¥
```cmd
docker exec postgres_local_test psql -U admin -d postgres -c "SELECT version();"
```

#### æ­¥éª¤4ï¼šæŸ¥çœ‹ ColorMagic è¡¨åˆ—è¡¨
```cmd
docker exec postgres_local_test psql -U admin -d postgres -c "\dt colormagic_*"
```

åº”è¯¥çœ‹åˆ° 7 ä¸ªè¡¨ï¼š
- colormagic_users
- colormagic_sessions
- colormagic_analysis_history
- colormagic_palettes
- colormagic_usage_stats
- colormagic_color_analysis
- colormagic_export_history

#### æ­¥éª¤5ï¼šæŸ¥çœ‹æµ‹è¯•æ•°æ®
```cmd
docker exec postgres_local_test psql -U admin -d postgres -c "SELECT username, email FROM colormagic_users;"
```

åº”è¯¥çœ‹åˆ°æµ‹è¯•ç”¨æˆ·ï¼š
```
 username |        email         
----------+----------------------
 testuser | test@colormagic.com
```

#### æ­¥éª¤6ï¼šæµ‹è¯•ç³»ç»Ÿç»Ÿè®¡
```cmd
docker exec postgres_local_test psql -U admin -d postgres -c "SELECT jsonb_pretty(get_system_stats()::jsonb);"
```

åº”è¯¥çœ‹åˆ°å®Œæ•´çš„ JSON ç»Ÿè®¡ä¿¡æ¯ã€‚

---

## ğŸ“Š ColorMagic æ•°æ®åº“ç»“æ„æ¦‚è§ˆ

### æ ¸å¿ƒè¡¨ï¼ˆ7ä¸ªï¼‰

1. **colormagic_users** - ç”¨æˆ·è¡¨
   - æ”¯æŒï¼šæ³¨å†Œã€ç™»å½•ã€è®¢é˜…ç®¡ç†
   - å­—æ®µï¼šemail, username, password_hash, subscription_type ç­‰

2. **colormagic_sessions** - ä¼šè¯è¡¨
   - æ”¯æŒï¼šJWT token ç®¡ç†ã€åˆ·æ–°ä»¤ç‰Œ
   - å­—æ®µï¼štoken_hash, refresh_token_hash, expires_at ç­‰

3. **colormagic_analysis_history** - ç”¨æˆ·åˆ†æå†å²
   - è®°å½•ç™»å½•ç”¨æˆ·çš„å›¾ç‰‡åˆ†æå†å²
   - å­—æ®µï¼šanalysis_result (JSONB), analysis_type, tags ç­‰

4. **colormagic_palettes** - æ”¶è—è°ƒè‰²æ¿
   - ç”¨æˆ·ä¿å­˜çš„è°ƒè‰²æ¿
   - å­—æ®µï¼špalette_name, colors (JSONB), tags ç­‰

5. **colormagic_usage_stats** - ä½¿ç”¨ç»Ÿè®¡
   - æŒ‰æ—¥ç»Ÿè®¡ç”¨æˆ·ä½¿ç”¨æƒ…å†µ
   - å­—æ®µï¼šdate, analyses_count, ai_analyses_count

6. **colormagic_color_analysis** - é¢œè‰²åˆ†æè®°å½•
   - è®°å½•æ‰€æœ‰çš„é¢œè‰²åˆ†æï¼ˆåŒ…æ‹¬åŒ¿åï¼‰
   - å­—æ®µï¼šanalysis_id, extracted_colors (JSONB), palette (JSONB) ç­‰

7. **colormagic_export_history** - å¯¼å‡ºå†å²
   - è®°å½•å¯¼å‡ºæ“ä½œ
   - å­—æ®µï¼šexport_format, color_count, file_size_bytes ç­‰

### ç³»ç»Ÿå‡½æ•°ï¼ˆ4ä¸ªï¼‰

1. **get_system_stats()** - è·å–æ€»ç³»ç»Ÿç»Ÿè®¡
2. **get_colormagic_system_stats()** - è·å– ColorMagic ç»Ÿè®¡
3. **get_active_sites()** - è·å–æ´»è·ƒç«™ç‚¹åˆ—è¡¨
4. **cleanup_expired_sessions()** - æ¸…ç†è¿‡æœŸä¼šè¯

### æµ‹è¯•æ•°æ®

ç³»ç»Ÿå·²å†…ç½®æµ‹è¯•æ•°æ®ï¼š
- **æµ‹è¯•ç”¨æˆ·**: testuser / test@colormagic.comï¼ˆå¯†ç ï¼štest123ï¼‰
- **æµ‹è¯•è°ƒè‰²æ¿**: "Sunset Colors"ï¼ˆCoral + Goldï¼‰
- **æµ‹è¯•åé¦ˆ**: 2æ¡ ColorMagic åé¦ˆè®°å½•

---

## ğŸ” è¯¦ç»†æµ‹è¯•é¡¹ç›®ï¼ˆ13é¡¹ï¼‰

è‡ªåŠ¨æµ‹è¯•è„šæœ¬ä¼šæ‰§è¡Œä»¥ä¸‹æ£€æŸ¥ï¼š

| # | æµ‹è¯•é¡¹ | è¯´æ˜ |
|---|--------|------|
| 1 | æ•°æ®åº“è¿æ¥ | éªŒè¯å¯ä»¥è¿æ¥åˆ° PostgreSQL |
| 2 | ç»Ÿä¸€åé¦ˆè¡¨ | æ£€æŸ¥å…±äº«åé¦ˆè¡¨æ˜¯å¦å­˜åœ¨ |
| 3 | ColorMagic è¡¨æ•°é‡ | éªŒè¯ 7 ä¸ªè¡¨æ˜¯å¦å…¨éƒ¨åˆ›å»º |
| 4 | colormagic_user è¿æ¥ | æµ‹è¯•ä¸“ç”¨ç”¨æˆ·æ˜¯å¦å¯ä»¥è¿æ¥ |
| 5 | colormagic_user æƒé™ | éªŒè¯ç”¨æˆ·æƒé™æ˜¯å¦æ­£ç¡® |
| 6 | æŸ¥è¯¢æµ‹è¯•ç”¨æˆ· | è¯»å–æµ‹è¯•ç”¨æˆ·æ•°æ® |
| 7 | æŸ¥è¯¢æµ‹è¯•è°ƒè‰²æ¿ | è¯»å–æµ‹è¯•è°ƒè‰²æ¿æ•°æ® |
| 8 | æŸ¥è¯¢åé¦ˆè®°å½• | è¯»å– ColorMagic åé¦ˆ |
| 9 | æ’å…¥åé¦ˆæµ‹è¯• | æµ‹è¯•æ’å…¥æ–°åé¦ˆ |
| 10 | æ’å…¥åˆ†æè®°å½• | æµ‹è¯•æ’å…¥é¢œè‰²åˆ†æè®°å½• |
| 11 | get_system_stats() | æµ‹è¯•ç³»ç»Ÿç»Ÿè®¡å‡½æ•° |
| 12 | get_colormagic_system_stats() | æµ‹è¯• ColorMagic ç»Ÿè®¡å‡½æ•° |
| 13 | get_active_sites() | æµ‹è¯•æ´»è·ƒç«™ç‚¹å‡½æ•° |

---

## ğŸ“– æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£

æµ‹è¯•å®Œæˆåï¼Œå¯ä»¥æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼š

```cmd
notepad ColorMagicæ•°æ®åº“ç»“æ„è¯¦è§£.md
```

æˆ–è€…åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼ˆå¦‚æœæœ‰ Markdown æŸ¥çœ‹å™¨ï¼‰ã€‚

---

## ğŸ¯ æµ‹è¯•å®Œæˆåçš„ä¸‹ä¸€æ­¥

### å¦‚æœæ‰€æœ‰æµ‹è¯•é€šè¿‡ âœ…

ä½ çš„ ColorMagic æ•°æ®åº“ç³»ç»Ÿå·²å®Œå…¨å°±ç»ªï¼ä¸‹ä¸€æ­¥ï¼š

1. **é…ç½®åº”ç”¨ç¯å¢ƒå˜é‡**
   ```env
   USE_DATABASE=true
   DB_HOST=postgres_master
   DB_PORT=5432
   DB_NAME=postgres
   DB_USER=colormagic_user
   DB_PASSWORD=ColorMagic_Local_Test_Pass
   SITE_ID=colormagic
   ```

2. **ç¡®ä¿åº”ç”¨ä½¿ç”¨æ­£ç¡®çš„è¡¨å**
   - `users` â†’ `colormagic_users`
   - `sessions` â†’ `colormagic_sessions`
   - `analysis_history` â†’ `colormagic_color_analysis`
   - ç­‰ç­‰...

3. **è¿æ¥åº”ç”¨å®¹å™¨åˆ° shared_net ç½‘ç»œ**
   ```yaml
   networks:
     - shared_net
   ```

4. **å¯åŠ¨åº”ç”¨å¹¶æµ‹è¯•**

---

### å¦‚æœæµ‹è¯•å¤±è´¥ âŒ

**å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ³•**ï¼š

1. **å®¹å™¨å¯åŠ¨å¤±è´¥**
   ```cmd
   # æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
   docker logs postgres_local_test
   
   # æ£€æŸ¥ç«¯å£å†²çª
   # å¦‚æœæœ¬åœ°å·²æœ‰ PostgreSQL åœ¨ 5432 ç«¯å£
   # ç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨ 5433 ç«¯å£
   ```

2. **è¡¨ä¸å­˜åœ¨**
   ```cmd
   # é‡æ–°åˆå§‹åŒ–ï¼ˆä¼šåˆ é™¤æ‰€æœ‰æ•°æ®ï¼‰
   docker compose -f docker-compose.local.yml down -v
   docker compose -f docker-compose.local.yml up -d
   ```

3. **æƒé™é”™è¯¯**
   ```cmd
   # æ£€æŸ¥æ—¥å¿—ä¸­çš„æƒé™é…ç½®ä¿¡æ¯
   docker logs postgres_local_test | findstr "æƒé™"
   ```

---

## ğŸ’¡ æœ‰ç”¨çš„å‘½ä»¤

### æ—¥å¸¸æ“ä½œ
```cmd
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
docker logs postgres_local_test -f

# è¿›å…¥æ•°æ®åº“ï¼ˆäº¤äº’å¼ï¼‰
docker exec -it postgres_local_test psql -U admin -d postgres

# åœæ­¢å®¹å™¨
docker compose -f docker-compose.local.yml down

# é‡å¯å®¹å™¨
docker compose -f docker-compose.local.yml restart
```

### æ•°æ®åº“æŸ¥è¯¢ï¼ˆåœ¨äº¤äº’å¼ psql ä¸­ï¼‰
```sql
-- åˆ—å‡ºæ‰€æœ‰è¡¨
\dt

-- åˆ—å‡º ColorMagic è¡¨
\dt colormagic_*

-- åˆ—å‡ºæ‰€æœ‰ç”¨æˆ·
\du

-- æŸ¥çœ‹è¡¨ç»“æ„
\d colormagic_users

-- é€€å‡º
\q
```

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. **æŸ¥çœ‹æ—¥å¿—**
   ```cmd
   docker logs postgres_local_test --tail 100
   ```

2. **æ£€æŸ¥ Docker çŠ¶æ€**
   ```cmd
   docker info
   ```

3. **æŸ¥çœ‹å®Œæ•´æ–‡æ¡£**
   - README.md
   - ä½¿ç”¨æŒ‡å—-å®Œæ•´ç‰ˆ.md
   - ColorMagicæ•°æ®åº“ç»“æ„è¯¦è§£.md

---

## â° ç°åœ¨å°±å¼€å§‹æµ‹è¯•ï¼

**ç«‹å³æ‰§è¡Œ**ï¼š

1. âœ… ç¡®è®¤ Docker Desktop å›¾æ ‡æ˜¯ç»¿è‰²çš„
2. âœ… åŒå‡»è¿è¡Œ `æœ¬åœ°æµ‹è¯•æŒ‡å—.bat`
3. âœ… ç­‰å¾… 1-2 åˆ†é’Ÿçœ‹åˆ°æµ‹è¯•ç»“æœ
4. âœ… æŸ¥çœ‹ `ColorMagicæ•°æ®åº“ç»“æ„è¯¦è§£.md` äº†è§£è¯¦æƒ…

---

**ç¥æµ‹è¯•é¡ºåˆ©ï¼** ğŸ‰

å¦‚æœæ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Œä½ çš„ ColorMagic æ•°æ®åº“ç³»ç»Ÿå°±å¯ä»¥æŠ•å…¥ä½¿ç”¨äº†ï¼

